<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="" />
    <script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.js"></script>
    <script src="sketch.js"></script>
  </head>
  <body>
    <p>Worms Game</p>
    <!-- <script src="./worms.js" async defer></script> -->
    <script>
      var s;
      var scl = 20;
      var food;

      function setup() {
        createCanvas(400, 400);
        s = new Worm();
        frameRate(10);
        pickLocation();
      }

      function pickLocation() {
        var cols = floor(width / scl);
        var rows = floor(height / scl);
        food = createVector(floor(random(cols)), floor(random(rows)));
        food.mult(scl);
      }

      function draw() {
        background(51);
        s.death();
        s.update();
        s.show();

        if (s.eat(food)) {
          pickLocation();
        }

        fill(255, 0, 100);
        rect(food.x, food.y, scl, scl);
      }

      function keyPressed() {
        if (keyCode === UP_ARROW) {
          s.direction(0, -1);
        } else if (keyCode === DOWN_ARROW) {
          s.direction(0, 1);
        } else if (keyCode === RIGHT_ARROW) {
          s.direction(1, 0);
        } else if (keyCode === LEFT_ARROW) {
          s.direction(-1, 0);
        }
      }

      function Worm() {
        this.x = 0;
        this.y = 0;
        this.xspeed = 1;
        this.yspeed = 0;
        this.total = 0;
        this.tail = [];

        this.direction = function(x, y) {
          this.xspeed = x;
          this.yspeed = y;
        };

        this.eat = function(position) {
          var d = dist(this.x, this.y, position.x, position.y);
          if (d < 1) {
            this.total++;
            return true;
          } else {
            return false;
          }
        };

        this.death = function() {
          for (var i = 0; i < this.tail.length; i++) {
            var position = this.tail[i];
            var distance = dist(this.x, this.y, position.x, position.y);
            if (distance < 1) {
              alert("You Got Got Pal");
              this.total = 0;
              this.tail = [];
            }
          }
        };

        this.update = function() {
          if (this.total === this.tail.length) {
            for (var i = 0; i < this.tail.length - 1; i++) {
              this.tail[i] = this.tail[i + 1];
            }
          }
          this.tail[this.total - 1] = createVector(this.x, this.y);

          this.x = this.x + this.xspeed * scl;
          this.y = this.y + this.yspeed * scl;

          this.x = constrain(this.x, 0, width - scl);
          this.y = constrain(this.y, 0, height - scl);
        };

        this.show = function() {
          fill(255);
          for (var i = 0; i < this.total; i++) {
            rect(this.tail[i].x, this.tail[i].y, scl, scl);
          }
          rect(this.x, this.y, scl, scl);
        };
      }
    </script>
  </body>
</html>
